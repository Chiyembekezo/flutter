<!DOCTYPE html>
<html>
<!-- <html manifest="assets/assets/web/cache.manifest"> -->

<head>
  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="Rive app">

  <base href="/" target="_self">

  <link rel="icon" type="image/png" sizes="32x32" href="https://rive.app/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://rive.app/favicon-16x16.png">

  <!-- iOS meta tags & icons -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="rive">
  <link rel="apple-touch-icon" sizes="192Ã—192" href="assets/assets/web/launcher-icon-192.png">

  <link rel="manifest" href="assets/assets/web/manifest.json">

  <title>Rive</title>
</head>

<body>
  <!-- FileSaver to download exported files -->
  <script src='https://cdn.jsdelivr.net/npm/file-saver@2.0.2/dist/FileSaver.min.js'></script>
  <!-- This script installs service_worker.js to provide PWA functionality to
       application. For more information, see:
       https://developers.google.com/web/fundamentals/primers/service-workers -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function () {
        navigator.serviceWorker.register('/flutter_service_worker.js');
      });
    }
  </script>
  <script>
    document.body.addEventListener("contextmenu", function (event) {
      event.preventDefault();
    });
  </script>
  <!-- Handle keyboard input events -->
  <script>
    window.addEventListener("keydown", function (event) {
      if (event.metaKey || event.ctrlKey) {
        // When ctrl or meta is pressed we want to suppress some default bound
        // browser actions (like CMD+Plus/Minus to zoom).
        switch (event.keyCode) {
          case 187: // '=' for zoom in
          case 189: // '-' for zoom out
          case 90: // 'z' for preventing opening a previous tab in Safari
            // Needs to be removed as it kills text copy
            // case 67:  // 'c' for preventing negative beep on Safari
            event.preventDefault();
            break;
            // default:
            //   console.log('Keycode pressed: ' + event.keyCode);
        }
      }
      // Suppress backspace triggering a navigate back action.
      if (event.keyCode == 8 && event.target == document.body) {
        event.preventDefault();
      }
    });
  </script>

  <!-- This is the counterpart to the window_utils_web.dart drop files interface. TODO: get this into Dart/plugin land.  -->
  <script>
    document.body.ondragover = function (event) {
      event.stopPropagation();
      event.preventDefault();
      event.dataTransfer.dropEffect = "copy";
    };

    document.body.ondragleave = function (event) {
      event.stopPropagation();
      event.preventDefault();
    };

    document.body.ondrop = function (event) {
      event.stopPropagation();
      event.preventDefault();
      let files = event.dataTransfer.files;
      const fileList = [];
      let reading = files.length;

      function _decReading() {
        reading--;
        if (reading == 0 && fileList.length != 0) {
          filesDropped(fileList);
        }
      }

      for (const file of files) {
        var fileReader = new FileReader();
        fileReader.onload = function () {
          const bytes = new Uint8Array(this.result);
          fileList.push({
            filename: file.name,
            bytes: bytes
          });
          _decReading();
        };
        fileReader.onerror = function () {
          _decReading();
        };
        fileReader.readAsArrayBuffer(file);
      }
    };

    function initInputHelper() {

      const pressedKeys = new Set();

      const metaKeyCode = 0x5B;
      const ctrlKeyCode = 0x11;
      const shiftKeyCode = 0x10;
      const altKeyCode = 0x12;

      function isModifier(code) {
        switch (code) {
          case metaKeyCode:
          case ctrlKeyCode:
          case shiftKeyCode:
          case altKeyCode:
            return true;
          default:
            return false;
        }
      }

      window.addEventListener("focus", function (event) {
        // Sync modifiers to released state.
        reportKey(metaKeyCode, false);
        reportKey(ctrlKeyCode, false);
        reportKey(shiftKeyCode, false);
        reportKey(altKeyCode, false);
      });

      function reportKey(code, isPress, isRepeat) {
        if (isModifier(code) && isPress && pressedKeys.has(code)) {
          // We already think this modifier key is pressed. We allow reporting
          // other keys multiple times.
          return false;
        }
        if (!isPress && !pressedKeys.has(code)) {
          // We already think the key is not pressed.
          return false;
        }

        // We need to report the key.
        if (isPress) {
          pressedKeys.add(code);
        } else {
          pressedKeys.delete(code);
        }

        if (!isPress) {
          code |= 1 << 18;
        }
        if (isRepeat) {
          code |= 1 << 17;
        }
        keyPressed(code);
        return true;
      }

      function syncModifiers(event) {
        if (reportKey(metaKeyCode, event.metaKey) && !event.metaKey) {
          // If meta was released, we need to notify that all other non modifier keys were released too.
          for (const code of pressedKeys) {
            if (!isModifier(code) && code != event.keyCode) {
              reportKey(code, false);
            }
          }
        }
        reportKey(ctrlKeyCode, event.ctrlKey);
        reportKey(shiftKeyCode, event.shiftKey);
        reportKey(altKeyCode, event.altKey);
      }

      window.addEventListener("keydown", function (event) {
        syncModifiers(event);
        reportKey(event.keyCode, true, event.repeat);
      });

      window.addEventListener("keyup", function (event) {
        syncModifiers(event);
        reportKey(event.keyCode, false);
      });
    }
  </script>
  <script src="main.dart.js?v=DEPLOYMENTVERSION" type="application/javascript"></script>
  <script>
    window._flutter_web_set_location_strategy(null);

    function getLocation() {
      return document.location.pathname;
    }
    
    window.onpopstate = function (event) {
      if (typeof travel != 'undefined') {
        travel(document.location.pathname);
      }

      event.preventDefault();
      event.stopPropagation();
    };
  </script>
</body>
</body>
</body>

</html>